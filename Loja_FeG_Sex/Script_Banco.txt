Create database FeG_Sex;

Go

Use FeG_Sex;

Go

Create Table Produtos(
Id_Prod int primary key identity,
Descricao varchar(100),
Quantidade int,
Dt_Cadastro datetime,
Vl_Compra decimal(10,2),
Vl_Venda decimal(10,2)
)

GO

Create Table Clientes(
Id_Cliente int primary Key identity,
Nome varchar(50),
Email varchar(50),
Sexo char(1),
Dt_Nasc datetime,
Dt_Cadastro datetime,
Telefone bigint,
Celular bigint,
Rua varchar(50),
Numero int,
Bairro varchar(30),
Complemento varchar(20)
)

GO

Create Table Vendas(
Id_Vendas int primary key identity,
Id_Produto int,
Id_Cliente int,
Quantidade int,
VL_Venda varchar(10),
Dt_Transacao datetime,
Tipo_Pagamento varchar(10),
Data_Pagamento datetime,
Constraint FK_Prod Foreign Key (Id_Produto) references Produtos(Id_Prod),
Constraint FK_Cli Foreign Key (Id_Cliente) references Clientes(Id_Cliente)
)

GO

Create Procedure sp_update_cliente

@ID int,
@Nome varchar(50),
@Email varchar(50),
@Sexo char(1),
@Dt_Nasc datetime,
@Dt_Cadastro datetime,
@Rua varchar(50),
@Numero int,
@Bairro varchar(30),
@Complemento varchar(20),
@Celular varchar(15),
@Telefone varchar(15)

AS Begin

Update Clientes Set Nome = @Nome, Email = @Email, Sexo = @Sexo, Dt_Nasc = @Dt_Nasc, Dt_Cadastro = @Dt_Cadastro,
Telefone = @Telefone, Celular = @Celular, Rua = @Rua, Numero = @Numero, Bairro = @Bairro, Complemento = @Complemento
Where Id_Cliente = @ID;

END

GO

Create Procedure [dbo].[sp_insert_cliente]

@Nome varchar(50),
@Email varchar(50),
@Sexo char(1),
@Dt_Nasc datetime,
@Dt_Cadastro datetime,
@Rua varchar(50),
@Numero int,
@Bairro varchar(30),
@Complemento varchar(20),
@Celular varchar(15),
@Telefone varchar(15)

AS Begin

INSERT INTO Clientes(Nome, Email, Sexo, Dt_Nasc, Dt_Cadastro, Telefone, Celular, Rua, Numero, Bairro, Complemento)
VALUES (@Nome, @Email, @Sexo, @Dt_Nasc, @Dt_Cadastro, @Telefone, @Celular, @Rua, @Numero, @Bairro, @Complemento);

END

GO

Create Procedure sp_insert_produto

@Descricao varchar(100),
@Quantidade int,
@Dt_Cadastro DateTime,
@Vl_Compra varchar(10),
@Vl_Venda varchar(10)

AS

BEGIN

insert into Produtos(Descricao, Quantidade, Dt_Cadastro, Vl_Compra, Vl_Venda)
Values(@Descricao, @Quantidade, @Dt_Cadastro, @Vl_Compra, @Vl_Venda);

END

Create Proc sp_update_produto

@ID int,
@Descricao varchar(100),
@Quantidade int,
@Dt_Cadastro DateTime,
@Vl_Compra varchar(10),
@Vl_Venda varchar(10)

AS

BEGIN

Update Produtos Set Descricao = @Descricao, Quantidade = @Quantidade, Dt_Cadastro = @Dt_Cadastro, Vl_Compra = @Vl_Compra, Vl_Venda = @Vl_Venda
Where Id_Prod = @ID;

END

GO

Create Proc sp_insert_venda

@Id_Prod int,
@Id_Cliente int,
@Quantidade int,
@Vl_Venda varchar(10),
@Dt_Transacao DateTime,
@Dt_Pagamento DateTime,
@Tipo_Pagamento varchar(15)

AS

Begin

Insert into Vendas (Id_Produto, Id_Cliente, Quantidade, VL_Venda, Dt_Transacao, Data_Pagamento, Tipo_Pagamento) 
Values (@Id_Prod, @Id_Cliente, @Quantidade, @Vl_Venda, @Dt_Transacao, @Dt_Pagamento, @Tipo_Pagamento)

END


GO


CREATE TRIGGER TRG_Baixa_Estoque ON Vendas
AFTER INSERT
AS
BEGIN
	DECLARE
	@Quantidade int,
	@Id_Produto int

	SELECT @Quantidade = Quantidade, @Id_Produto = Id_Produto FROM INSERTED

	Update Produtos set Quantidade = Quantidade - @Quantidade Where Id_Prod = @Id_Produto;
END
GO
